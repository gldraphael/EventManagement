# EF Migrations

All EF related commands must be run in the context of the Infrastructure project. So first, `cd` into its directory:

```bash
cd apps/api/src/Eventuras.Infrastructure
```

## Adding a migration

````bash
dotnet ef migrations add MigrationDescription -s ../Eventuras.WebApi/Eventuras.WebApi.csproj
dotnet ef migrations script --idempotent -s ../Eventuras.WebApi/Eventuras.WebApi.csproj --output ./sqlscript/database-migrations.sql
dotnet ef migrations bundle  -s ../Eventuras.WebApi/Eventuras.WebApi.csproj
``

## Applying a Migration

Either run the sql script generated by the previous command or run the following command:

```bash
dotnet ef database update -s ../Eventuras.WebApi/Eventuras.WebApi.csproj
````

If you need to run migrations from ssh, you might use the efbundle. The efbundle is a self-contained executable that can be run on the server. It is generated by the `dotnet ef migrations bundle` command above. Make sure a connectionsstring is available on the server with a connectionstring.

## Read more

- [EF Core Migrations](https://learn.microsoft.com/en-us/ef/core/managing-schemas/migrations/applying?tabs=dotnet-core-cli)
